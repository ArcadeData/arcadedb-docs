[[cypher-expressions]]
=== Expressions and Functions
image:../images/edit.png[link="https://github.com/ArcadeData/arcadedb-docs/blob/main/src/main/asciidoc/query-languages/cypher/cypher-expressions.adoc" float=right]

This section describes the expressions and functions available in ArcadeDB's OpenCypher implementation.

[discrete]
==== Literals

[%header,cols="2,3,3"]
|===
| Type | Syntax | Example
| Integer | `123`, `-456` | `RETURN 42`
| Float | `3.14`, `-2.5` | `RETURN 3.14159`
| String | `'text'`, `"text"` | `RETURN 'Hello'`
| Boolean | `true`, `false` | `RETURN true`
| Null | `null` | `RETURN null`
| List | `[1, 2, 3]` | `RETURN [1, 'a', true]`
| Map | `{key: value}` | `RETURN {name: 'Alice', age: 30}`
|===

[discrete]
==== Property Access

Access properties using dot notation:

[source,cypher]
----
MATCH (p:Person)
RETURN p.name, p.age, p.address.city
----

[discrete]
==== CASE Expression

Conditional logic in expressions.

*Simple CASE:*

[source,cypher]
----
MATCH (p:Person)
RETURN p.name,
       CASE
         WHEN p.age < 18 THEN 'minor'
         WHEN p.age < 65 THEN 'adult'
         ELSE 'senior'
       END AS ageGroup
----

*Extended CASE:*

[source,cypher]
----
MATCH (p:Person)
RETURN p.name,
       CASE p.status
         WHEN 'A' THEN 'Active'
         WHEN 'I' THEN 'Inactive'
         ELSE 'Unknown'
       END AS statusName
----

[discrete]
==== Arithmetic Expressions

Perform arithmetic operations on numeric values.

[%header,cols="2,2,3"]
|===
| Operator | Description | Example
| `+` | Addition | `RETURN 5 + 3` (returns 8)
| `-` | Subtraction | `RETURN 10 - 4` (returns 6)
| `*` | Multiplication | `RETURN 6 * 7` (returns 42)
| `/` | Division | `RETURN 15 / 3` (returns 5.0)
| `%` | Modulo | `RETURN 17 % 5` (returns 2)
| `^` | Power | `RETURN 2 ^ 8` (returns 256.0)
|===

*Examples with properties:*

[source,cypher]
----
// Double a person's age
MATCH (p:Person)
RETURN p.name, p.age * 2 AS doubleAge

// Calculate monthly salary
MATCH (p:Person)
RETURN p.name, p.salary / 12 AS monthlySalary

// Complex expression
MATCH (p:Person)
RETURN p.name, (p.age * 2) + 10 AS result
----

NOTE: The `+` operator also works for string concatenation: `RETURN 'Hello' + ' ' + 'World'` returns `'Hello World'`.

[discrete]
==== Map Literals

Create inline map (object) structures.

*Syntax:* `{key1: value1, key2: value2, ...}`

[source,cypher]
----
// Simple map literal
RETURN {name: 'Alice', age: 30}

// Empty map
RETURN {}

// Map with expressions
MATCH (p:Person)
WHERE p.name = 'Alice'
RETURN {
  personName: p.name,
  doubled: p.age * 2,
  nextYearAge: p.age + 1
} AS info
----

[discrete]
==== List Comprehensions

Transform and filter lists using comprehension syntax.

*Syntax:* `[variable IN list WHERE condition | expression]`

* `variable` - iteration variable
* `list` - source list or range
* `WHERE condition` - optional filter (elements that don't match are excluded)
* `| expression` - optional mapping expression (transforms each element)

*Basic transformation:*

[source,cypher]
----
// Double each number
RETURN [x IN [1, 2, 3] | x * 2]
// Returns [2, 4, 6]

// Square numbers using range
RETURN [x IN range(1, 5) | x * x]
// Returns [1, 4, 9, 16, 25]
----

*With filter:*

[source,cypher]
----
// Filter and transform
RETURN [x IN [1, 2, 3, 4, 5] WHERE x > 2 | x * 10]
// Returns [30, 40, 50]

// Filter only (no transformation)
RETURN [x IN [1, 2, 3, 4, 5] WHERE x > 3]
// Returns [4, 5]
----

[discrete]
==== Map Projections

Extract specific properties from nodes or maps into a new map structure.

*Syntax:* `variable{.property1, .property2, key: expression, .*}`

* `.property` - include this property from the source
* `key: expression` - add a computed value with the given key
* `.*` - include all properties from the source

*Property selection:*

[source,cypher]
----
// Select specific properties
MATCH (p:Person)
WHERE p.name = 'Alice'
RETURN p{.name, .age} AS person
// Returns {name: 'Alice', age: 30}
----

*With computed values:*

[source,cypher]
----
// Add computed properties
MATCH (p:Person)
WHERE p.name = 'Alice'
RETURN p{.name, doubleAge: p.age * 2} AS person
// Returns {name: 'Alice', doubleAge: 60}
----

*All properties:*

[source,cypher]
----
// Include all properties
MATCH (p:Person)
WHERE p.name = 'Alice'
RETURN p{.*} AS person
// Returns {name: 'Alice', age: 30, salary: 50000}
----

---

[[cypher-aggregation-functions]]
[discrete]
==== Aggregation Functions

Aggregation functions process multiple values and return a single result.

[[cypher-count]]
[discrete]
===== count()

Returns the number of values or rows.

[source,cypher]
----
// Count nodes
MATCH (p:Person)
RETURN count(p)

// Count all rows
MATCH (p:Person)
RETURN count(*)

// Count non-null values
MATCH (p:Person)
RETURN count(p.email)
----

[[cypher-sum]]
[discrete]
===== sum()

Returns the sum of numeric values.

[source,cypher]
----
MATCH (p:Person)
RETURN sum(p.salary)
----

[[cypher-avg]]
[discrete]
===== avg()

Returns the average of numeric values.

[source,cypher]
----
MATCH (p:Person)
RETURN avg(p.age)
----

[[cypher-min]]
[discrete]
===== min()

Returns the minimum value.

[source,cypher]
----
MATCH (p:Person)
RETURN min(p.age) AS youngest
----

[[cypher-max]]
[discrete]
===== max()

Returns the maximum value.

[source,cypher]
----
MATCH (p:Person)
RETURN max(p.age) AS oldest
----

[[cypher-collect]]
[discrete]
===== collect()

Collects values into a list.

[source,cypher]
----
// Collect all names
MATCH (p:Person)
RETURN collect(p.name) AS allNames

// Group and collect
MATCH (p:Person)-[:LIVES_IN]->(c:City)
RETURN c.name, collect(p.name) AS residents
----

---

[[cypher-string-functions]]
[discrete]
==== String Functions

[[cypher-toupper]]
[discrete]
===== toUpper()

Converts string to uppercase.

[source,cypher]
----
RETURN toUpper('hello')  // Returns 'HELLO'
----

[[cypher-tolower]]
[discrete]
===== toLower()

Converts string to lowercase.

[source,cypher]
----
RETURN toLower('HELLO')  // Returns 'hello'
----

[[cypher-trim]]
[discrete]
===== trim()

Removes leading and trailing whitespace.

[source,cypher]
----
RETURN trim('  hello  ')  // Returns 'hello'
----

[[cypher-substring]]
[discrete]
===== substring()

Extracts a substring.

*Syntax:* `substring(string, start [, length])`

[source,cypher]
----
RETURN substring('hello world', 0, 5)  // Returns 'hello'
RETURN substring('hello world', 6)      // Returns 'world'
----

[[cypher-replace]]
[discrete]
===== replace()

Replaces occurrences of a substring.

*Syntax:* `replace(string, search, replacement)`

[source,cypher]
----
RETURN replace('hello', 'l', 'L')  // Returns 'heLLo'
----

[[cypher-split]]
[discrete]
===== split()

Splits a string into a list.

*Syntax:* `split(string, delimiter)`

[source,cypher]
----
RETURN split('a,b,c', ',')  // Returns ['a', 'b', 'c']
----

[discrete]
===== left()

Returns the leftmost characters.

*Syntax:* `left(string, length)`

[source,cypher]
----
RETURN left('hello', 3)  // Returns 'hel'
----

[discrete]
===== right()

Returns the rightmost characters.

*Syntax:* `right(string, length)`

[source,cypher]
----
RETURN right('hello', 3)  // Returns 'llo'
----

[discrete]
===== reverse()

Reverses a string.

[source,cypher]
----
RETURN reverse('hello')  // Returns 'olleh'
----

[discrete]
===== toString()

Converts a value to string.

[source,cypher]
----
RETURN toString(123)      // Returns '123'
RETURN toString(3.14)     // Returns '3.14'
RETURN toString(true)     // Returns 'true'
----

---

[[cypher-math-functions]]
[discrete]
==== Math Functions

[[cypher-abs]]
[discrete]
===== abs()

Returns absolute value.

[source,cypher]
----
RETURN abs(-42)  // Returns 42
----

[[cypher-sqrt]]
[discrete]
===== sqrt()

Returns square root.

[source,cypher]
----
RETURN sqrt(16)  // Returns 4.0
----

[[cypher-ceil]]
[discrete]
===== ceil()

Rounds up to nearest integer.

[source,cypher]
----
RETURN ceil(2.3)  // Returns 3.0
----

[[cypher-floor]]
[discrete]
===== floor()

Rounds down to nearest integer.

[source,cypher]
----
RETURN floor(2.7)  // Returns 2.0
----

[[cypher-round]]
[discrete]
===== round()

Rounds to nearest integer.

[source,cypher]
----
RETURN round(2.5)  // Returns 3.0
RETURN round(2.4)  // Returns 2.0
----

[[cypher-rand]]
[discrete]
===== rand()

Returns random float between 0 and 1.

[source,cypher]
----
RETURN rand()  // Returns e.g. 0.7324...
----

---

[[cypher-list-functions]]
[discrete]
==== List Functions

[[cypher-size]]
[discrete]
===== size()

Returns the size of a list or string.

[source,cypher]
----
RETURN size([1, 2, 3])      // Returns 3
RETURN size('hello')        // Returns 5
----

[[cypher-head]]
[discrete]
===== head()

Returns the first element of a list.

[source,cypher]
----
RETURN head([1, 2, 3])  // Returns 1
----

[[cypher-tail]]
[discrete]
===== tail()

Returns all but the first element.

[source,cypher]
----
RETURN tail([1, 2, 3])  // Returns [2, 3]
----

[[cypher-last]]
[discrete]
===== last()

Returns the last element of a list.

[source,cypher]
----
RETURN last([1, 2, 3])  // Returns 3
----

[[cypher-range]]
[discrete]
===== range()

Creates a list of integers.

*Syntax:* `range(start, end [, step])`

[source,cypher]
----
RETURN range(1, 5)     // Returns [1, 2, 3, 4, 5]
RETURN range(0, 10, 2) // Returns [0, 2, 4, 6, 8, 10]
----

[[cypher-reverse]]
[discrete]
===== reverse() (list)

Reverses a list.

[source,cypher]
----
RETURN reverse([1, 2, 3])  // Returns [3, 2, 1]
----

---

[[cypher-node-functions]]
[discrete]
==== Node and Relationship Functions

[[cypher-id]]
[discrete]
===== id()

Returns the internal ID (RID) of a node or relationship.

[source,cypher]
----
MATCH (p:Person)
RETURN id(p)  // Returns e.g. '#12:0'
----

[[cypher-labels]]
[discrete]
===== labels()

Returns the labels of a node as a list.

[source,cypher]
----
MATCH (p:Person)
RETURN labels(p)  // Returns ['Person']
----

[[cypher-type]]
[discrete]
===== type()

Returns the type of a relationship.

[source,cypher]
----
MATCH (a)-[r]->(b)
RETURN type(r)  // Returns e.g. 'KNOWS'
----

[[cypher-keys]]
[discrete]
===== keys()

Returns the property keys of a node or relationship.

[source,cypher]
----
MATCH (p:Person {name: 'Alice', age: 30})
RETURN keys(p)  // Returns ['name', 'age']
----

[[cypher-properties]]
[discrete]
===== properties()

Returns all properties as a map.

[source,cypher]
----
MATCH (p:Person {name: 'Alice', age: 30})
RETURN properties(p)  // Returns {name: 'Alice', age: 30}
----

[[cypher-startnode]]
[discrete]
===== startNode()

Returns the start node of a relationship.

[source,cypher]
----
MATCH (a)-[r:KNOWS]->(b)
RETURN startNode(r)  // Returns node a
----

[[cypher-endnode]]
[discrete]
===== endNode()

Returns the end node of a relationship.

[source,cypher]
----
MATCH (a)-[r:KNOWS]->(b)
RETURN endNode(r)  // Returns node b
----

---

[[cypher-path-functions]]
[discrete]
==== Path Functions

[discrete]
===== length()

Returns the length of a path (number of relationships).

[source,cypher]
----
MATCH path = (a:Person)-[:KNOWS*]->(b:Person)
RETURN length(path)
----

[discrete]
===== nodes()

Returns the nodes in a path as a list.

[source,cypher]
----
MATCH path = (a:Person)-[:KNOWS*]->(b:Person)
RETURN nodes(path)
----

[discrete]
===== relationships()

Returns the relationships in a path as a list.

[source,cypher]
----
MATCH path = (a:Person)-[:KNOWS*]->(b:Person)
RETURN relationships(path)
----

---

[[cypher-type-conversion]]
[discrete]
==== Type Conversion Functions

[discrete]
===== toInteger()

Converts to integer.

[source,cypher]
----
RETURN toInteger('42')      // Returns 42
RETURN toInteger(3.7)       // Returns 3
----

[discrete]
===== toFloat()

Converts to float.

[source,cypher]
----
RETURN toFloat('3.14')      // Returns 3.14
RETURN toFloat(42)          // Returns 42.0
----

[discrete]
===== toBoolean()

Converts to boolean.

[source,cypher]
----
RETURN toBoolean('true')    // Returns true
RETURN toBoolean(1)         // Returns true
RETURN toBoolean(0)         // Returns false
----

---

[[cypher-sql-bridge]]
[discrete]
==== SQL Function Bridge

ArcadeDB's OpenCypher implementation includes a bridge to all ArcadeDB SQL functions. This provides access to 100+ additional functions.

*Usage:*

Call SQL functions directly in Cypher expressions:

[source,cypher]
----
// Date functions
MATCH (p:Person)
RETURN p.name, date() AS today

// Math functions
RETURN pow(2, 8) AS result  // Returns 256

// String functions
MATCH (p:Person)
RETURN normalize(p.name) AS normalizedName

// Geometric functions
RETURN distance(point(0, 0), point(3, 4)) AS dist  // Returns 5.0
----

For a complete list of available SQL functions, see the <<sql-functions,SQL Functions>> reference.

---

[[cypher-operators]]
[discrete]
==== Operators

[discrete]
===== Comparison Operators

[%header,cols="2,3,3"]
|===
| Operator | Description | Example
| `=` | Equal | `WHERE n.age = 30`
| `<>` or `!=` | Not equal | `WHERE n.age <> 30`
| `<` | Less than | `WHERE n.age < 30`
| `>` | Greater than | `WHERE n.age > 30`
| `<=` | Less than or equal | `WHERE n.age <= 30`
| `>=` | Greater than or equal | `WHERE n.age >= 30`
|===

[discrete]
===== Logical Operators

[%header,cols="2,3,3"]
|===
| Operator | Description | Example
| `AND` | Logical AND | `WHERE n.age > 20 AND n.age < 40`
| `OR` | Logical OR | `WHERE n.city = 'NYC' OR n.city = 'LA'`
| `NOT` | Logical NOT | `WHERE NOT n.active = false`
|===

[discrete]
===== String Operators

[%header,cols="2,3,3"]
|===
| Operator | Description | Example
| `STARTS WITH` | String prefix match | `WHERE n.name STARTS WITH 'A'`
| `ENDS WITH` | String suffix match | `WHERE n.email ENDS WITH '@gmail.com'`
| `CONTAINS` | Substring match | `WHERE n.name CONTAINS 'son'`
| `=~` | Regular expression | `WHERE n.phone =~ '[0-9]{3}-[0-9]{4}'`
|===

[discrete]
===== List Operators

[%header,cols="2,3,3"]
|===
| Operator | Description | Example
| `IN` | Element in list | `WHERE n.name IN ['Alice', 'Bob']`
| `+` | List concatenation | `RETURN [1,2] + [3,4]` (returns [1,2,3,4])
|===

[discrete]
===== Null Operators

[%header,cols="2,3,3"]
|===
| Operator | Description | Example
| `IS NULL` | Check for null | `WHERE n.email IS NULL`
| `IS NOT NULL` | Check for not null | `WHERE n.email IS NOT NULL`
|===

---

[[cypher-parameters]]
[discrete]
==== Parameters

Parameters allow you to pass values into queries without string concatenation, providing security and performance benefits.

*Syntax:* `$parameterName`

[source,cypher]
----
MATCH (p:Person)
WHERE p.name = $name AND p.age >= $minAge
RETURN p
----

*Java Example:*

[source,java]
----
Map<String, Object> params = Map.of(
    "name", "Alice",
    "minAge", 25
);
ResultSet result = database.query("opencypher",
    "MATCH (p:Person) WHERE p.name = $name AND p.age >= $minAge RETURN p",
    params);
----

Parameters are particularly useful for:

* Preventing injection attacks
* Query plan caching (same plan reused for different parameter values)
* Handling special characters in values

